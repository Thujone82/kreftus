// gif.js 0.2.0 - https://github.com/jnordberg/gif.js
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var NeuQuant=require("./TypedNeuQuant.js");var LZWEncoder=require("./LZWEncoder.js");function ByteArray(){this.page=-1;this.pages=[];this.newPage()}ByteArray.pageSize=4096;ByteArray.charMap={};for(var i=0;i<256;i++)ByteArray.charMap[i]=String.fromCharCode(i);ByteArray.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(ByteArray.pageSize);this.cursor=0};ByteArray.prototype.getData=function(){var rv="";for(var p=0;p<this.pages.length;p++){for(var i=0;i<ByteArray.pageSize;i++){rv+=ByteArray.charMap[this.pages[p][i]]}}return rv};ByteArray.prototype.writeByte=function(val){if(this.cursor>=ByteArray.pageSize)this.newPage();this.pages[this.page][this.cursor++]=val};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};function GIFEncoder(width,height){this.width=~~width;this.height=~~height;this.transparent=null;this.transIndex=0;this.repeat=-1;this.delay=0;this.image=null;this.pixels=null;this.indexedPixels=null;this.colorDepth=null;this.colorTab=null;this.neuQuant=null;this.usedEntry=new Array;this.palSize=7;this.dispose=-1;this.firstFrame=true;this.sample=10;this.dither=false;this.globalPalette=false;this.out=new ByteArray}GIFEncoder.prototype.setDelay=function(milliseconds){this.delay=Math.round(milliseconds/10)};GIFEncoder.prototype.setFrameRate=function(fps){this.delay=Math.round(1e3/(this.delay*fps))};GIFEncoder.prototype.setDispose=function(code){if(code>=0)this.dispose=code};GIFEncoder.prototype.setRepeat=function(iter){if(iter>=0)this.repeat=iter};GIFEncoder.prototype.setTransparent=function(color){this.transparent=color};GIFEncoder.prototype.addFrame=function(imageData){this.image=imageData;this.colorDepth=8;this.palSize=7;this.usedEntry=new Array;this.getImagePixels();this.analyzePixels();if(this.globalPalette)this.buildGlobalPalette();else this.buildPalette();this.writeLSD();this.writePalette();if(this.repeat>=0)this.writeNetscapeExt();this.writeGraphicCtrlExt();this.writeImageDesc();this.writePixels()};GIFEncoder.prototype.finish=function(){this.out.writeByte(59)};GIFEncoder.prototype.buildGlobalPalette=function(){this.colorTab=this.neuQuant.process()};GIFEncoder.prototype.buildPalette=function(){var pal=this.neuQuant.process();this.colorTab=pal};GIFEncoder.prototype.getImagePixels=function(){var w=this.width;var h=this.height;this.pixels=new Uint8Array(w*h*3);var data=this.image;var src=0;var step=3;var C=255;for(var i=0;i<h;i++){for(var j=0;j<w;j++){var b=data[src+2];var g=data[src+1];var r=data[src];this.pixels[step-3]=r;this.pixels[step-2]=g;this.pixels[step-1]=b;src+=4;step+=3}}};GIFEncoder.prototype.analyzePixels=function(){var len=this.pixels.length;var nPix=len/3;this.indexedPixels=new Uint8Array(nPix);var C=255;this.neuQuant=new NeuQuant(this.pixels,this.sample);this.neuQuant.buildColormap();this.colorTab=this.neuQuant.getColormap();var k=0;for(var j=0;j<nPix;j++){var b=this.pixels[k++];var g=this.pixels[k++];var r=this.pixels[k++];var index=this.neuQuant.lookupRGB(b,g,r);this.usedEntry[index]=true;this.indexedPixels[j]=index}};GIFEncoder.prototype.writeLSD=function(){this.writeUTFBytes("GIF89a");this.writeShort(this.width);this.writeShort(this.height);this.out.writeByte(128|this.palSize);this.out.writeByte(0);this.out.writeByte(0)};GIFEncoder.prototype.writeShort=function(pValue){this.out.writeByte(pValue&255);this.out.writeByte(pValue>>8&255)};GIFEncoder.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var n=3*256-this.colorTab.length;for(var i=0;i<n;i++)this.out.writeByte(0)};GIFEncoder.prototype.writeNetscapeExt=function(){this.out.writeByte(33);this.out.writeByte(255);this.out.writeByte(11);this.writeUTFBytes("NETSCAPE2.0");this.out.writeByte(3);this.out.writeByte(1);this.writeShort(this.repeat);this.out.writeByte(0)};GIFEncoder.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33);this.out.writeByte(249);this.out.writeByte(4);var transp,disp;if(this.transparent===null){transp=0;disp=0}else{transp=1;disp=2}if(this.dispose>=0){disp=this.dispose&7}disp<<=2;this.out.writeByte(0|disp|transp);this.writeShort(this.delay);this.out.writeByte(this.transIndex);this.out.writeByte(0)};GIFEncoder.prototype.writeImageDesc=function(){this.out.writeByte(44);this.writeShort(0);this.writeShort(0);this.writeShort(this.width);this.writeShort(this.height);if(this.firstFrame||!this.globalPalette){this.out.writeByte(0)}else{this.out.writeByte(128|this.palSize)}if(this.firstFrame)this.firstFrame=false};GIFEncoder.prototype.writePixels=function(){var enc=new LZWEncoder(this.width,this.height,this.indexedPixels,this.colorDepth);enc.encode(this.out)};module.exports=GIFEncoder},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(require,module,exports){var EOF=-1;var BITS=12;var HSIZE=5003;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095];function LZWEncoder(width,height,pixels,color_depth){var initCodeSize=Math.max(2,color_depth);var accum=new Uint8Array(256);var htab=new Int32Array(HSIZE);var codetab=new Int32Array(HSIZE);var cur_accum,cur_bits=0;var a_count;var free_ent=0;var maxcode;var clear_flg=false;var g_init_bits,n_bits;var max_ent,n_ent;var remaining=pixels.length;var curPixel=0;function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)}function cl_block(outs){cl_hash(HSIZE);free_ent=clear_code+2;clear_flg=true;output(clear_code,outs)}function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]= -1}function compress(init_bits,outs){var fcode,c,i,ent,disp,hsize_reg,hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);clear_code=1<<init_bits-1;eof_code=clear_code+1;free_ent=clear_code+2;a_count=0;ent=next_pixel();hshift=0;for(fcode=HSIZE;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=HSIZE;cl_hash(hsize_reg);output(clear_code,outs);outer_loop:while((c=next_pixel())!=EOF){fcode=(c<<BITS)+ent;i=c<<hshift^ent;if(htab[i]===fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i===0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]===fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<1<<BITS){codetab[i]=free_ent++;htab[i]=fcode}else cl_block(outs)}output(ent,outs);output(eof_code,outs)}function encode(outs){outs.writeByte(initCodeSize);remaining=pixels.length;curPixel=0;compress(initCodeSize+1,outs);outs.writeByte(0)}function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}}function MAXCODE(n_bits){return(1<<n_bits)-1}function next_pixel(){if(remaining===0)return EOF;--remaining;var pix=pixels[curPixel++];return pix&255}function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if((free_ent>maxcode||clear_flg)&&cur_bits>0){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==BITS)maxcode=1<<BITS;else maxcode=MAXCODE(n_bits)}
}if(code==eof_code){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}}this.encode=encode}module.exports=LZWEncoder},{}],3:[function(require,module,exports){var ncycles=100;var netsize=256;var maxnetpos=netsize-1;var netbiasshift=4;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;function NeuQuant(thepixels,samplefac){var network;var netindex;var bias;var freq;var radpower;function NeuQuant(){network=new Array(netsize);netindex=new Int32Array(256);bias=new Int32Array(netsize);freq=new Int32Array(netsize);radpower=new Int32Array(netsize>>3);var i,v;for(i=0;i<netsize;i++){v=(i<<netbiasshift+8)/netsize;network[i]=new Float64Array([v,v,v,0]);freq[i]=intbias/netsize;bias[i]=0}}function buildColormap(){NeuQuant();learn();unbiasnet();buildnetindex()}function getColormap(){var map=new Uint8Array(netsize*3);var index=new Uint8Array(netsize);for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map}function buildnetindex(){for(var i=0;i<netsize;i++){netindex[network[i][0]>>netbiasshift<<16|network[i][1]>>netbiasshift<<8|network[i][2]>>netbiasshift]=i}}function unbiasnet(){for(var i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}}function alterneigh(rad,i,b,g,r){var j,k,p,a,dist;var lo=Math.abs(i-rad);var hi=Math.min(i+rad,netsize);j=i+1;k=i-1;p=1;while(j<hi||k>lo){a=radpower[p++];if(j<hi){dist=network[j][0]-b;if(dist*dist>=a)j=hi;else{if(j-i&1){dist=network[j][1]-g;if(dist*dist>=a)j=hi;else{dist=network[j][2]-r;if(dist*dist>=a)j=hi;else{network[j][0]-=dist*network[j][0]-b>>alpharadbshift;network[j][1]-=dist*network[j][1]-g>>alpharadbshift;network[j][2]-=dist*network[j][2]-r>>alpharadbshift}}}j++}}if(k>lo){dist=network[k][0]-b;if(dist*dist>=a)k=lo;else{if(k-i&1){dist=network[k][1]-g;if(dist*dist>=a)k=lo;else{dist=network[k][2]-r;if(dist*dist>=a)k=lo;else{network[k][0]-=dist*network[k][0]-b>>alpharadbshift;network[k][1]-=dist*network[k][1]-g>>alpharadbshift;network[k][2]-=dist*network[k][2]-r>>alpharadbshift}}}k--}}}}function contest(b,g,r){var i,dist,a,bestd,best;bestd=~1<<31;best= -1;i=netsize;while(i--){dist=network[i][0]-b;if(dist<0)dist= -dist;a=network[i][1]-g;if(a<0)a= -a;dist+=a;a=network[i][2]-r;if(a<0)a= -a;dist+=a;if(dist<bestd){bestd=dist;best=i}}return best}function learn(){var i,j,b,g,r;var lengthcount=thepixels.length;var alphadec=30+(samplefac-1)/3;var samplepixels=lengthcount/(3*samplefac);var delta=~~(samplepixels/ncycles);var alpha=initalpha;var radius=initradius;var rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));var step;if(lengthcount<1509)samplefac=1;step=0;i=0;while(i<samplepixels){b=thepixels[step+0]&255;g=thepixels[step+1]&255;r=thepixels[step+2]&255;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad)alterneigh(rad,j,b,g,r);step+=samplefac*3;if(step>=lengthcount)step-=lengthcount;i++;if(delta===0)delta=1;if(i%delta===0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}return network}function altersingle(alpha,i,b,g,r){network[i][0]-=alpha*(network[i][0]-b)/initalpha;network[i][1]-=alpha*(network[i][1]-g)/initalpha;network[i][2]-=alpha*(network[i][2]-r)/initalpha}this.buildColormap=buildColormap;this.getColormap=getColormap;this.lookupRGB=function(b,g,r){var i,dist,a,bestd,best;bestd=~1<<31;best= -1;i=netsize;while(i--){dist=network[i][0]-b;if(dist<0)dist= -dist;a=network[i][1]-g;if(a<0)a= -a;dist+=a;a=network[i][2]-r;if(a<0)a= -a;dist+=a;if(dist<bestd){bestd=dist;best=i}}return best}}module.exports=NeuQuant},{}]},{},[1])
//# sourceMappingURL=gif.js.map
this.workerScript = 'js/gif.worker.js';